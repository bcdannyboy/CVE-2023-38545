#!/bin/bash

# Install Dante Server
sudo apt update
sudo apt install -y dante-server

# Backup original config
sudo cp /etc/danted.conf /etc/danted.conf.bak

# Get the active network interface
INTERFACE=$(ip route | grep default | awk '{print $5}')

# Create new Dante config
echo "logoutput: stderr
user.privileged: root
user.unprivileged: nobody

# The listening network interface or address.
internal: 0.0.0.0 port=1080

# The proxying network interface or address.
external: $INTERFACE

method: username none
client pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: error
}
pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    command: bind connect udpassociate
    log: error
    method: none
}" | sudo tee /etc/danted.conf

# Restart Dante server
sudo systemctl restart danted

echo "Dante SOCKS5 proxy is set up on port 1080."
